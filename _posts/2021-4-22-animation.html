<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Animation | Urmila J</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="30 Day Chart Challenge contribution 2021 by Urmila.">
    
    <link rel="preload" href="/30daychartchallenge/assets/css/0.styles.02421d88.css" as="style"><link rel="preload" href="/30daychartchallenge/assets/js/app.bd8bdbcf.js" as="script"><link rel="preload" href="/30daychartchallenge/assets/js/2.2e525a3d.js" as="script"><link rel="preload" href="/30daychartchallenge/assets/js/22.68fe9605.js" as="script"><link rel="prefetch" href="/30daychartchallenge/assets/js/10.bd81b691.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/11.516d0fb2.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/12.0e40a051.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/13.b6687479.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/14.8594d23c.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/15.16fd3ec0.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/16.42cbdc52.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/17.cf2dd924.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/18.0173b01a.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/19.dbd7d002.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/20.75b1ff94.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/21.410a435f.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/23.3b65595a.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/24.b4a717b2.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/25.6fa1674e.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/26.7b899c36.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/27.256f0c22.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/28.009bc3bd.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/29.7e538b46.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/3.b76cff15.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/30.5f93defd.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/31.af4fe6a2.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/32.ee2bfe20.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/33.4642f797.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/34.7421b3c8.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/35.bdc7d76c.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/36.17997cbd.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/37.5d1689bd.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/38.132f3370.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/39.cd0aef31.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/4.1778016d.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/40.df6cc9a6.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/41.14b50959.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/42.89cbb28c.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/43.926862f5.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/44.94cc6a53.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/5.62b724db.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/6.9c72bc75.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/7.e388c6fd.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/8.38f726ef.js"><link rel="prefetch" href="/30daychartchallenge/assets/js/9.f86c896a.js">
    <link rel="stylesheet" href="/30daychartchallenge/assets/css/0.styles.02421d88.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/30daychartchallenge/" class="home-link router-link-active"><!----> <span class="site-name">Urmila J</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/30daychartchallenge/Charts/" class="nav-link">
  Charts
</a></div><div class="nav-item"><a href="/30daychartchallenge/About/" class="nav-link">
  About
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/30daychartchallenge/Charts/" class="nav-link">
  Charts
</a></div><div class="nav-item"><a href="/30daychartchallenge/About/" class="nav-link">
  About
</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="earthquakes-1900-2014"><a href="#earthquakes-1900-2014" class="header-anchor">#</a> Earthquakes (1900-2014).</h1> <h2 id="week-4-timeseries-day-22-animation"><a href="#week-4-timeseries-day-22-animation" class="header-anchor">#</a> Week 4: Timeseries. Day 22: Animation.</h2> <br> <p>For day 22 I used one of my old charts as a contribution, actually this is one of the first chart I made after I learnt the basics of D3, it's an interactive world map and lollipop chart with animations, it fit the topic for the day. <br></p> <p>Here's the final interactive chart.</p> <br> <p><img src="/30daychartchallenge/images/day22/chart-22.gif" alt="Earthquakes (1900-2014)"></p> <br> <h2 id="data"><a href="#data" class="header-anchor">#</a> Data</h2> <p>Data Source: <a href="https://public.tableau.com/en-us/s/resources" target="_blank" rel="noopener noreferrer">Tableau<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Data for the chart: Here is the link to the <a href="https://raw.githubusercontent.com/urmilaj/30daycharts2021/gh-pages/data/earthquake.csv" target="_blank" rel="noopener noreferrer">data.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <br> <h2 id="create-the-chart-with-d3-js"><a href="#create-the-chart-with-d3-js" class="header-anchor">#</a> Create the chart with D3.js</h2> <br> <ul><li>Github link to <a href="https://urmilaj.github.io/30daycharts2021/quake.html" target="_blank" rel="noopener noreferrer">chart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and code <a href="https://github.com/urmilaj/30daycharts2021/blob/gh-pages/quake.html" target="_blank" rel="noopener noreferrer">repository.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Setup the <a href="/30daychartchallenge/Charts.html">basic html. Follow the instructions here.</a></li> <li>Create the chart.</li></ul> <br> <p>This chart has a dropdown button for user interaction. When the user chooses a year from the dropdown, the chart will update with that data. To create the dropdown use the code below. In the html section create a select tag with id &quot;selectButton&quot;. Using d3, select the button and create placeholder for all the years in our data, bind the data and since our years range from 1900 to 2014, use d3.range to create an array between that range, join the options. Use text to display the year text and attribute value to specify its value.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//Create a dropdown button for years</span>
d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;#selectButton&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&quot;options&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1900</span><span class="token punctuation">,</span><span class="token number">2015</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;option&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token operator">+</span>d<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token operator">+</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>We have two data files, a json file with geographic data and the csv file with earthquake data. Using Promise load both the files and it's time to visualize.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>d3<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&quot;data/50m.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
d3<span class="token punctuation">.</span><span class="token function">csv</span><span class="token punctuation">(</span><span class="token string">&quot;data/earthquake.csv&quot;</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    Date<span class="token operator">:</span> <span class="token function">parseTime</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">,</span>
    Latitude<span class="token operator">:</span> <span class="token operator">+</span>d<span class="token punctuation">.</span>Latitude<span class="token punctuation">,</span>
    Longitude<span class="token operator">:</span> <span class="token operator">+</span>d<span class="token punctuation">.</span>Longitude<span class="token punctuation">,</span>
    Magnitude<span class="token operator">:</span> <span class="token operator">+</span>d<span class="token punctuation">.</span>Magnitude<span class="token punctuation">,</span>
    Place<span class="token operator">:</span> d<span class="token punctuation">.</span>Place<span class="token punctuation">,</span>
    Year<span class="token operator">:</span> <span class="token operator">+</span>d<span class="token punctuation">.</span>Year
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">initialize</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Lets set up all our required variables.</p> <ul><li>The json file which has all the geographic data, let's call that world. The csv file with all the earthquake data, lets call that...well &quot;data&quot;. ðŸ˜‚ <br></li> <li>The csv data has a date column which is currently in string format, to make it to date time format, use d3.timeParse to convert the date column. <br></li> <li>Along with the d3 library, use the topojson library to help draw the map. Using the topojson library use topojson.feature and call the world data inside it. <br></li> <li>Use d3.geo projections to use the type of projections you want, I have used d3.geoNaturalEarth, as the projection of choice. <br></li> <li>d3.geoPath will help draw the map with our desired projection choice.</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> world <span class="token operator">=</span> initialize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> initialize<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> parseTime <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">&quot;%d-%m-%Y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> land <span class="token operator">=</span> topojson<span class="token punctuation">.</span><span class="token function">feature</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span>world<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>land<span class="token punctuation">)</span>

<span class="token keyword">const</span> projection <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">geoNaturalEarth1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">fitExtent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>margin<span class="token punctuation">.</span>mapTop<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>width<span class="token punctuation">,</span><span class="token number">700</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">&quot;Sphere&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">precision</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">165</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">geoPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>Since the chart updates on user interaction, create a function called update which filters the data based on the selected year and loads the chart each time. <br></li> <li>Line 2 in the code below will help remove all elements which was drawn previously and update with the current year selection. This is important to put as the first line on our function otherwise we would have multiple svg elements data getting drawn on each other. <br></li> <li>Now lets filter our csv data based on the use selected year. <br></li> <li>Now it's time to set up our scales based on the filtered data. It'm important to put the scale and axis funtion inside the function because the domain differs for each year and it will help render the lollipop chart accurately.</li> <li>The x scale, y scale, xAxis and yAxis are for the lollipop chart. The radius variable will be used for both the map and lollipop, to size the circles according to Magnitude. Projection variable will help render the earthquake data points on the map. <br> <img src="/30daychartchallenge/images/day22/lollipop.png" alt="Lollipop Chart"></li> <li>The lollipop chart above will be drawn with an x axis which will use the d3.scaleTime to set up the domain and range in the x variable based on the dataset.</li> <li>The y axis will use d3.scaleLinear to  draw the magnitude data of the earthquakes.</li> <li>To draw the axis, set up the scales first as on line 6 and 13. Then call these scale in the x axis and y axis to draw them.</li> <li>If you notice on the lollipop chart each circle of the lollipop differs in size based on its magnitude, earthquakes with higher magnitudes have bigger circles compared to lower level earthquake magnitudes. Now to size the circles according to magnitude, use d3.scaleSqrt and specify the range as 5 to 15 which means lower magnitude earthquakes will have circles with 5 pixel radius and higher magnitude earthquakes will have circles with 15 pixel radius. (Line 26.)</li></ul> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted">Â </div><br><br><br><div class="highlighted">Â </div><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">selectedYear</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  d3<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&quot;g &gt; *&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token keyword">let</span> filter <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token operator">=&gt;</span>d<span class="token punctuation">.</span>Year<span class="token operator">==</span>selectedYear<span class="token punctuation">)</span>

  <span class="token keyword">const</span> x <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span><span class="token function">extent</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>margin<span class="token punctuation">.</span>left<span class="token punctuation">,</span>width<span class="token operator">-</span>margin<span class="token punctuation">.</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">xAxis</span> <span class="token operator">=</span> <span class="token parameter">g</span> <span class="token operator">=&gt;</span> g<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;transform&quot;</span><span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(0,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token operator">-</span>margin<span class="token punctuation">.</span>bottom<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span><span class="token function">axisBottom</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> y <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span><span class="token function">extent</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span>d<span class="token punctuation">.</span>Magnitude<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>height<span class="token operator">-</span>margin<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span>margin<span class="token punctuation">.</span>bubbleTop<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">yAxis</span> <span class="token operator">=</span> <span class="token parameter">g</span> <span class="token operator">=&gt;</span> g<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;transform&quot;</span><span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>margin<span class="token punctuation">.</span>left<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,0)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span><span class="token function">axisLeft</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">g</span> <span class="token operator">=&gt;</span> g<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&quot;.tick line&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;stroke&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;stroke-opacity&quot;</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;x2&quot;</span><span class="token punctuation">,</span>width<span class="token operator">-</span>margin<span class="token punctuation">.</span>right<span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">g</span><span class="token operator">=&gt;</span>g<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;.domain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> radius <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleSqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span><span class="token function">extent</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span>d<span class="token punctuation">.</span>Magnitude<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>Set the chart title. The chart's title will dynamically change according to the year the user has selected. To do this simply add line 6 to make it dynamic.</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted">Â </div><br><br><br></div><pre class="language-js"><code>svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;chartTitle&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;text-anchor&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;middle&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">&quot;Earthquakes: &quot;</span><span class="token operator">+</span>selectedYear<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;font-size&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3em&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;font-weight&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bold&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>To draw the map.</p> <ul><li>Declare a variable and append a group element with attribute map as a class.</li> <li>append a path and bind the datum land to it, then using attribute d draw the path for the map.</li> <li>Now to append the earthquakes to the map. Use map.selectAll(&quot;quake&quot;) which will create a placeholder for the earthquake circles, bind the filter data, use join to determine how many circles will be added.</li> <li>The circles cx and cy will depend on the latitude and longitude data. Use projection which will be the scale to place the points on the map. Inside the projection scale use the longitude and latitude data and specify [0] for cx (the circles center x), similarly specify [1] for cy (the circles center y).</li> <li>To make the circles on the map animate that is grow gradually, declare the circles radius as zero first, then use transition with a duration to set the radius to the magnitude. line (16, 21-24).</li> <li>Thats it our map and the earthquake projections on the map are ready.</li></ul> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br></div><pre class="language-js"><code><span class="token keyword">const</span> map <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">)</span>

map<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">datum</span><span class="token punctuation">(</span>land<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;fill&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;#7770a0&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;stroke&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;indigo&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;opacity&quot;</span><span class="token punctuation">,</span><span class="token number">0.75</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> quakes <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&quot;quake&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;circle&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;quake&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;cx&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">projection</span><span class="token punctuation">(</span><span class="token punctuation">[</span>d<span class="token punctuation">.</span>Longitude<span class="token punctuation">,</span>d<span class="token punctuation">.</span>Latitude<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;cy&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">projection</span><span class="token punctuation">(</span><span class="token punctuation">[</span>d<span class="token punctuation">.</span>Longitude<span class="token punctuation">,</span>d<span class="token punctuation">.</span>Latitude<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;fill&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;indigo&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;stroke&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;orange&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;stroke-width&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>

quakes<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token number">1200</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">ease</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span>easeLinear<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">radius</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Magnitude<span class="token punctuation">)</span><span class="token punctuation">)</span>     
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>Now that the map is done. Time to make the lollipop chart.</p> <ul><li>Append a group element and call the xAxis to draw the x axis for the chart.</li> <li>Append a group element and call the yAxis to draw the y axis for the chart.</li> <li>Annotate the y axis as Magnitude. Since the x-axis clearly shows the month names, I did not annotate the x axis.
<img src="/30daychartchallenge/images/day22/chart-annotation.gif" alt="Chart Annotation"></li> <li>Now in the gif above, the middle of the chart has a text that tells the user to hover over the lollipop chart to display more information. When the user over the lollipop bubbles/circles this will display the earthquake location and the magnitude. Append this text (line 15-21) with class name &quot;hoverText&quot; which will later be used for the interactivity.</li></ul> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br></div><pre class="language-js"><code>svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>xAxis<span class="token punctuation">)</span>

svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>yAxis<span class="token punctuation">)</span>

svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span><span class="token operator">-</span>height<span class="token operator">+</span><span class="token number">350</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">&quot;Magnitude&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;text-anchor&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;transform&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rotate(-90)&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;font-size&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1.1em&quot;</span><span class="token punctuation">)</span>

svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hoverText&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> height<span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">25</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;text-anchor&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;middle&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;font-size&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2em&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">&quot;Hover over lollipop chart for info.&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>Append a new group element.
The lollipop is made of the lollipop stick and lollipop itself which is the circle.</p> <ul><li>To draw the circle (lines 3-13), use d3.selectAll, bind the data, join the circle, give it class called &quot;bubble&quot;, the circle's &quot;cx&quot; will be the date attribute of the data and &quot;cy&quot; will be the magnitude of the data.</li> <li>The lollipop animates vertically, to do this first set the &quot;cy&quot; of the circle to height-margin.bottom, which is the point the x axis lies. Then use transition and change the &quot;cy&quot; position to the magnitude. line (8 and line 19).</li> <li>The lollipop stick which is the vertical line is drawn using x1,y1,x2,y2 attributes. x2 and y2 will be the points lying on the x axis. x1 and y1 will be the points lying based on the magnitude data.</li> <li>The line also animates along with the circles, therefore set the &quot;y1&quot; attribute of the line to height-margin.bottom and then using transition set the &quot;y1&quot; to the magnitude. (line 27,36)</li></ul> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><br></div><pre class="language-js"><code><span class="token keyword">const</span> g <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bubbles <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&quot;circle&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;circle&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bubble&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;cx&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">x</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;cy&quot;</span><span class="token punctuation">,</span>height<span class="token operator">-</span>margin<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;stroke&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;orange&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;stroke-width&quot;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;fill&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;indigo&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;opacity&quot;</span><span class="token punctuation">,</span><span class="token number">0.75</span><span class="token punctuation">)</span>
  
bubbles<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token number">1200</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">ease</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span>easeLinear<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;cx&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">x</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;cy&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">y</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Magnitude<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">radius</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Magnitude<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bubbleLine <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&quot;line&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;line&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bubbleLine&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;x1&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">x</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;y1&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span>height<span class="token operator">-</span>margin<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;x2&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">x</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;y2&quot;</span><span class="token punctuation">,</span>height<span class="token operator">-</span>margin<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;fill&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;stroke&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;black&quot;</span><span class="token punctuation">)</span>
          
bubbleLine<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token number">1200</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">ease</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span>easeLinear<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;y1&quot;</span><span class="token punctuation">,</span><span class="token parameter">d</span><span class="token operator">=&gt;</span><span class="token function">y</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Magnitude<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>Now to add the interactivity to the chart. Follow the code below.</p> <ul><li>The lollipops in the code are called bubbles. Attach an event handler to the bubbles.</li> <li>Using &quot;on&quot; which will listen for user interaction on the bubbles which is mouseover or touchstart, when this interaction occurs use d3.select the hoverText class which is the annotation in the middle of the chart and change the text to the data of the bubble that is being hovered on. line (4)</li> <li>When the user hovers over the bubble it interacts with the map, the earthquake points on the map gray out and only the bubble data that corresponds to the map data will display. Im doing this using javascript ternary operators, when I use d3.selectAll(&quot;.quake&quot;) it has the underlying data for all the map circles being displayed which for example will be called v. The bubbles that we're interacting with has data with it too, which we'll call d. On line 6 , in attribute fill we compare this data using ternary operators to compare the place column of the earthquake and the bubble that is being hovered on, if the data matches the earthquake point on the map will remain indigo otherwise the fill change to grey.</li> <li>When the user stops hovering over the lollipop everything goes back to normal. This does on happen automatically, it needs to specified with another event handler (line 7), which makes the chart listen for mouseout or touchend user interaction and when this occurs the hoverText will go back to the original displayed text and the earthquakes displayed on the map will change to indigo.</li></ul> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted">Â </div><br><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br><br></div><pre class="language-js"><code>bubbles
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;mouseover touchstart&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span>d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;.hoverText&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Place<span class="token operator">+</span><span class="token string">&quot; : Magnitude &quot;</span><span class="token operator">+</span>d<span class="token punctuation">.</span>Magnitude<span class="token punctuation">)</span>
    d3<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&quot;.quake&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;fill&quot;</span><span class="token punctuation">,</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span>v<span class="token punctuation">.</span>Place<span class="token operator">==</span>d<span class="token punctuation">.</span>Place<span class="token operator">?</span><span class="token string">&quot;indigo&quot;</span><span class="token operator">:</span><span class="token string">&quot;lightgrey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;mouseout touchend&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span>d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;.hoverText&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">&quot;Hover over lollipop chart for info.&quot;</span><span class="token punctuation">)</span>
    d3<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&quot;.quake&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;fill&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;indigo&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>          
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>All the interactivity on the chart begins with the user's selection of the year. Lets bind an event handler to the dropdown button. <br>
Using d3.select, select the dropdown by using the id name &quot;#selectButton&quot;, attach an event handler to it. The change attribute on the event handler listens for any changes in the year, when this happens, declare a variable called selectedOption which will hold the year value selected by the user (line 3). <br>
Call the update function we created earlier with the selectedOption variable to draw the chart, for the year chosen by the user. <br> <br></p> <p>What is line 7 in the code below you may wonder? Well when the page loads a chart is rendered and that chart is for the year 1900. To render the initial chart we call the update function with the value 1900 inside to draw the chart.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> currentYear <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;#selectButton&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span>d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> selectedOption <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span>
    <span class="token function">update</span><span class="token punctuation">(</span>selectedOption<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token number">1900</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/30daychartchallenge/_posts/2021-4-21-downwards.html" class="prev">
        Downwards
      </a></span> <span class="next"><a href="/30daychartchallenge/_posts/2021-4-23-tiles.html">
        Tiles
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/30daychartchallenge/assets/js/app.bd8bdbcf.js" defer></script><script src="/30daychartchallenge/assets/js/2.2e525a3d.js" defer></script><script src="/30daychartchallenge/assets/js/22.68fe9605.js" defer></script>
  </body>
</html>
